let c=1,l=JSON.parse(localStorage.getItem("mmb-cart")||"[]");document.addEventListener("DOMContentLoaded",function(){m(),y();const e=document.querySelectorAll('input[name="conditionnement"]');e.length>0&&(e[0].checked=!0,setTimeout(()=>{u()},100))});function y(){document.querySelectorAll('input[name="conditionnement"]');const e=document.getElementById("quantity-input");e&&e.addEventListener("change",function(){c=parseInt(this.value)||1,c<1&&(c=1,this.value="1")})}function u(){const e=document.querySelectorAll('input[name="conditionnement"]'),n=document.querySelector('input[name="conditionnement"]:checked');if(e.forEach(t=>{const i=t.closest("label");if(!i)return;const o=i.querySelector(".relative"),s=i.querySelector(".w-5.h-5.border-2"),r=i.querySelector(".w-2\\.5.h-2\\.5.bg-green-500"),a=i.querySelector(".absolute.inset-0");!o||!s||!r||!a||(o.classList.remove("border-green-500","shadow-lg"),o.classList.add("border-gray-200"),s.classList.remove("border-green-500"),s.classList.add("border-gray-300"),r.classList.remove("opacity-100","scale-100"),r.classList.add("opacity-0","scale-0"),a.classList.remove("opacity-100","scale-100"),a.classList.add("opacity-0","scale-95"))}),n){const t=document.getElementById("selection-info"),i=document.getElementById("selected-conditionnement");i&&(i.textContent=n.value),t&&(t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("opacity-100","scale-100")},10));const o=n.closest("label");if(o){const s=o.querySelector(".relative"),r=o.querySelector(".w-5.h-5.border-2"),a=o.querySelector(".w-2\\.5.h-2\\.5.bg-green-500"),d=o.querySelector(".absolute.inset-0");s&&r&&a&&d&&(s.classList.remove("border-gray-200"),s.classList.add("border-green-500","shadow-lg"),r.classList.remove("border-gray-300"),r.classList.add("border-green-500"),a.classList.remove("opacity-0","scale-0"),a.classList.add("opacity-100","scale-100"),d.classList.remove("opacity-0","scale-95"),d.classList.add("opacity-100","scale-100"))}}else{const t=document.getElementById("selection-info");t&&(t.classList.remove("opacity-100","scale-100"),setTimeout(()=>{t.classList.add("hidden")},300))}}function f(){c++;const e=document.getElementById("quantity-input");e&&(e.value=c.toString())}function p(){if(c>1){c--;const e=document.getElementById("quantity-input");e&&(e.value=c.toString())}}function g(){const e=document.querySelector('input[name="conditionnement"]:checked');if(!e){alert("Veuillez sélectionner un conditionnement");return}const n=document.querySelector("h1")?.textContent?.trim()||"Produit",t=document.querySelector(".text-xl.text-green-600")?.textContent?.trim()||"",i=document.querySelector(".aspect-square img")?.getAttribute("src")||"",o=window.location.pathname.split("/").pop()||"produit",s={id:`${o}-${e.value}`,nom:n,variete:t,conditionnement:e.value,quantite:c,image:i,slug:o},r=l.findIndex(d=>d.id===s.id);r!==-1?l[r].quantite+=c:l.push(s),localStorage.setItem("mmb-cart",JSON.stringify(l)),m(),v(),c=1;const a=document.getElementById("quantity-input");a&&(a.value="1")}function v(){if(!document.querySelector('input[name="conditionnement"]:checked'))return;const n=document.createElement("div");n.className="fixed top-32 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-2xl z-50 transform translate-x-full transition-transform duration-300",n.innerHTML=`
        <div class="flex items-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          <span>Ajouté au panier !</span>
        </div>
      `,document.body.appendChild(n),setTimeout(()=>{n.classList.remove("translate-x-full")},100),setTimeout(()=>{n.classList.add("translate-x-full"),setTimeout(()=>{document.body.removeChild(n)},300)},3e3)}function m(){const e=document.getElementById("cart-indicator"),n=document.getElementById("cart-count");if(e&&n){const t=l.reduce((i,o)=>i+o.quantite,0);t>0?(e.classList.remove("hidden"),n.textContent=t.toString()):e.classList.add("hidden")}}function h(){window.location.href="/panier"}const L=document.querySelectorAll('input[name="conditionnement"]');L.forEach(e=>{e.addEventListener("change",u);const n=e.closest("label");n&&(n.addEventListener("mouseenter",function(){if(!e.checked){const t=this.querySelector(".relative");t&&t.classList.add("border-green-300")}}),n.addEventListener("mouseleave",function(){if(!e.checked){const t=this.querySelector(".relative");t&&(t.classList.remove("border-green-300"),t.classList.add("border-gray-200"))}}))});window.decrementQuantity=p;window.incrementQuantity=f;window.addToCart=g;window.goToCart=h;
