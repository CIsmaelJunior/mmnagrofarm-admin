---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CardProduit from '../components/CardProduit.astro';
import { getAllProduits } from '../data/produits';

const produits = getAllProduits();

// Cat√©gories pour le filtrage
const categories = [
  { id: 'tous', label: 'Tous les produits', icon: 'üå±', count: produits.length },
  { id: 'legumes', label: 'L√©gumes', icon: 'ü•¨', count: produits.filter(p => !['pasteque-baby-doll', 'melon-galia'].includes(p.slug)).length },
  { id: 'fruits', label: 'Fruits', icon: 'üçé', count: produits.filter(p => ['pasteque-baby-doll', 'melon-galia'].includes(p.slug)).length }
];

// Fonction pour d√©terminer la cat√©gorie d'un produit
function getCategorie(produit: any) {
  const fruits = ['pasteque-baby-doll', 'melon-galia'];
  return fruits.includes(produit.slug) ? 'fruits' : 'legumes';
}
---

<Layout title="Nos Produits - MMB AgroFarm" description="D√©couvrez notre gamme compl√®te de fruits et l√©gumes cultiv√©s en C√¥te d'Ivoire. Qualit√© et fra√Æcheur garanties.">
  <Header />
  
  <!-- Hero Section -->
  <section class="pt-32 pb-20 bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 relative overflow-hidden">
    <!-- √âl√©ments d√©coratifs -->
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-green-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-emerald-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
      <div class="absolute top-40 left-40 w-80 h-80 bg-teal-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>
    </div>
    
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="text-center max-w-4xl mx-auto">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-6">
          <span class="text-3xl">üåæ</span>
        </div>
        <h1 class="text-5xl lg:text-6xl font-bold text-gray-900 mb-6 leading-tight">
          Nos Produits
        </h1>
        <p class="text-xl lg:text-2xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
          D√©couvrez notre s√©lection de fruits et l√©gumes bio, 
          cultiv√©s avec passion et respect de la nature sur nos terres en C√¥te d'Ivoire.
        </p>
        <div class="mt-8 flex flex-wrap justify-center gap-4">
          <div class="flex items-center space-x-2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            <span class="text-sm font-medium text-gray-700">{produits.length} produits disponibles</span>
          </div>
          <div class="flex items-center space-x-2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg">
            <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
            <span class="text-sm font-medium text-gray-700">100% Bio & Local</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Filtres et Grille -->
  <section class="py-20 -mt-10 relative z-20 bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Filtres -->
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-16 border border-gray-100">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Filtrer par cat√©gorie</h2>
          <p class="text-gray-600">Trouvez rapidement ce que vous cherchez</p>
        </div>
        
        <div class="flex flex-wrap justify-center gap-4">
          {categories.map((categorie) => (
            <button
              class="categorie-filter group relative px-8 py-4 rounded-xl text-base font-medium transition-all duration-300 transform hover:scale-105 hover:shadow-lg"
              data-categorie={categorie.id}
              data-active={categorie.id === 'tous' ? 'true' : 'false'}
            >
              <div class="flex items-center space-x-3">
                <span class="text-xl group-hover:scale-110 transition-transform duration-300">{categorie.icon}</span>
                <span>{categorie.label}</span>
                <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs font-medium group-hover:bg-green-100 group-hover:text-green-700 transition-colors duration-300">
                  {categorie.count}
                </span>
              </div>
              <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
            </button>
          ))}
        </div>
      </div>

      <!-- Grille des produits -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10" id="produits-grid">
        {produits.map((produit, index) => (
          <div class="produit-card transform transition-all duration-500" data-categorie={getCategorie(produit)} style={`animation-delay: ${index * 100}ms`}>
            <CardProduit produit={produit} />
          </div>
        ))}
      </div>

      <!-- Message si aucun produit -->
      <div id="no-products" class="hidden text-center py-16">
        <div class="w-32 h-32 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
          <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-3">Aucun produit trouv√©</h3>
        <p class="text-gray-600 text-lg mb-6">Essayez de modifier vos filtres de recherche.</p>
        <button 
          onclick="resetFilters()"
          class="inline-flex items-center justify-center px-6 py-3 text-base font-medium text-green-600 border-2 border-green-600 rounded-lg hover:bg-green-600 hover:text-white transition-all duration-200"
        >
          R√©initialiser les filtres
        </button>
      </div>
    </div>
  </section>

  <!-- Section CTA -->
  <section class="py-20 bg-gradient-to-br from-gray-50 to-gray-100 relative overflow-hidden">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23e5e7eb" fill-opacity="0.4"%3E%3Ccircle cx="30" cy="30" r="2"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-30"></div>
    
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
      <div class="max-w-4xl mx-auto">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-6">
          <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
        </div>
        <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
          Besoin d'informations <span class="text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-600">sp√©cifiques</span> ?
        </h2>
        <p class="text-xl text-gray-600 mb-10 max-w-3xl mx-auto leading-relaxed">
          Notre √©quipe est √† votre disposition pour r√©pondre √† toutes vos questions 
          sur nos produits, nos tarifs et nos conditions de livraison.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/contact"
            class="inline-flex items-center justify-center px-10 py-5 text-lg font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-600 rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
          >
            Nous contacter
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
          <a
            href="/a-propos"
            class="inline-flex items-center justify-center px-10 py-5 text-lg font-semibold text-green-600 border-2 border-green-600 rounded-xl hover:bg-green-600 hover:text-white transition-all duration-300 transform hover:scale-105"
          >
            En savoir plus
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>

<style>
  .categorie-filter {
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    color: #6b7280;
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
  }

  .categorie-filter[data-active="true"] {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    color: white;
    border-color: #059669;
    transform: scale(1.05);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .categorie-filter:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    color: white;
    border-color: #059669;
  }

  .produit-card {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease-out forwards;
  }

  .produit-card.hidden {
    display: none;
  }

  .produit-card:hover {
    transform: translateY(-8px);
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes blob {
    0% {
      transform: translate(0px, 0px) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
    100% {
      transform: translate(0px, 0px) scale(1);
    }
  }

  .animate-blob {
    animation: blob 7s infinite;
  }

  .animation-delay-2000 {
    animation-delay: 2s;
  }

  .animation-delay-4000 {
    animation-delay: 4s;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .categorie-filter {
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
    }
    
    .produit-card {
      animation-delay: 0ms !important;
    }
  }
</style>

<script>
  // Syst√®me de filtrage
  const filterButtons = document.querySelectorAll('.categorie-filter');
  const produitCards = document.querySelectorAll('.produit-card');
  const noProductsMessage = document.getElementById('no-products');

  function filterProduits(categorie: string) {
    let visibleCount = 0;

    produitCards.forEach(card => {
      const cardCategorie = card.getAttribute('data-categorie');
      
      if (categorie === 'tous' || cardCategorie === categorie) {
        card.classList.remove('hidden');
        visibleCount++;
      } else {
        card.classList.add('hidden');
      }
    });

    // Afficher/masquer le message "aucun produit"
    if (noProductsMessage) {
      if (visibleCount === 0) {
        noProductsMessage.classList.remove('hidden');
      } else {
        noProductsMessage.classList.add('hidden');
      }
    }
  }

  function resetFilters() {
    // R√©initialiser les boutons
    filterButtons.forEach(btn => {
      btn.setAttribute('data-active', 'false');
      btn.classList.remove('bg-green-600', 'text-white');
      btn.classList.add('bg-gray-100', 'text-gray-600');
    });

    // R√©activer le premier bouton (Tous)
    const firstButton = filterButtons[0];
    if (firstButton) {
      firstButton.setAttribute('data-active', 'true');
      firstButton.classList.remove('bg-gray-100', 'text-gray-600');
      firstButton.classList.add('bg-green-600', 'text-white');
    }

    // Afficher tous les produits
    filterProduits('tous');
  }

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      // Mettre √† jour l'√©tat actif des boutons
      filterButtons.forEach(btn => {
        btn.setAttribute('data-active', 'false');
        btn.classList.remove('bg-green-600', 'text-white');
        btn.classList.add('bg-gray-100', 'text-gray-600');
      });

      button.setAttribute('data-active', 'true');
      button.classList.remove('bg-gray-100', 'text-gray-600');
      button.classList.add('bg-green-600', 'text-white');

      // Filtrer les produits
      const categorie = button.getAttribute('data-categorie');
      if (categorie) {
        filterProduits(categorie);
      }
    });
  });

  // Animation d'apparition des cartes au chargement
  document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.produit-card');
    cards.forEach((card, index) => {
      setTimeout(() => {
        card.classList.add('animate-fade-in');
      }, index * 100);
    });
  });
</script>
